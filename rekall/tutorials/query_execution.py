from rekall import Interval, IntervalSet, IntervalSetMapping, Bounds3D
from rekall.predicates import *
from helpers import *
import time 

def query3():
    bboxes = get_maskrcnn_bboxes()

    object_classes = {}
    for k in bboxes:
        for interval in bboxes[k].get_intervals():
            if interval['payload']['class'] not in object_classes:
                object_classes[interval['payload']['class']] = 1
            else:
                object_classes[interval['payload']['class']] += 1
    print(object_classes)

    # Run query 1: object followed by another object.
    tik = time.time()
    bboxes = get_maskrcnn_bboxes()

    car = bboxes.filter(lambda interval: interval['payload']['class'] == 'car')
    truck = bboxes.filter(lambda interval: interval['payload']['class'] == 'truck')

    car_trackings = car.coalesce(
        ('t1', 't2'),
        bounds_merge_op = Bounds3D.span,
        predicate = iou_at_least(0.5),
        epsilon = 0
    )

    car_trackings_filtered = car_trackings.filter_size(
        min_size = 1
    )

    truck_trackings = truck.coalesce(
        ('t1', 't2'),
        bounds_merge_op = Bounds3D.span,
        predicate = iou_at_least(0.5),
        epsilon = 0
    )

    truck_trackings_filtered = truck_trackings.filter_size(
        min_size = 1
    )

    truck_before_car = truck_trackings_filtered.join(
        car_trackings_filtered,
        predicate = Bounds3D.T(before(min_dist=0, max_dist=10)),
        merge_op = lambda interval1, interval2: Interval(
            interval1['bounds'].span(interval2['bounds'])
        ),
        window = 10.0,
        progress_bar = True
    )
    tok = time.time()

    print("query time: ", tok - tik)

    # Print query results
    res = []
    for k in truck_before_car:
        intervals = truck_before_car[k].get_intervals()
        for interval in intervals:
            res.append((k, interval['t1'], interval['t2']))

    print(res)
    print(len(res))

def query2(optimized=False):
    bboxes = get_maskrcnn_bboxes()

    # res = []
    # for k in bboxes:
    #     intervals = bboxes[k].get_intervals()
    #     for interval in intervals:
    #         res.append((k, interval['t1'], interval['t2']))

    tik = time.time()
    bboxes = get_maskrcnn_bboxes()

    car = bboxes.filter(lambda interval: interval['payload']['class'] == 'car')

    counts_per_frame = car.group_by(
        key=lambda obj: (obj["t1"], obj["t2"]), 
        merge=lambda key, intervalset: Interval(
            Bounds3D(key[0], key[1], 0.3, 0.7, 0.3, 0.7), 
            payload={ 'count': intervalset.size() }
        ) 
    )

    count_gt_20 = counts_per_frame \
        .filter(lambda intrvl: intrvl['payload']['count'] > 6) \
        .coalesce(
            ('t1', 't2'),
            bounds_merge_op = Bounds3D.span,
            predicate = iou_at_least(0.1),
            epsilon = 0
        ) \
        .filter_size(min_size = 1)

    # Construct base ism:
    if optimized:
        count_lt_5 = counts_per_frame \
        .filter(lambda intrvl: intrvl['payload']['count'] < 5) \
        .coalesce(
            ('t1', 't2'),
            bounds_merge_op = Bounds3D.span,
            predicate = iou_at_least(0.1),
            epsilon = 0
        ) \
        .filter_size(min_size = 0.5)
    else:
        video_lengths = {
            key: bboxes[key].get_intervals()[-1]['t2']
            for key in bboxes
        }

        base_ism = IntervalSetMapping({
            key: IntervalSet([
                Interval(Bounds3D(
                    t1 = 0,
                    t2 = video_lengths[key],
                    x1 = 0.3,
                    x2 = 0.7,
                    y1 = 0.3,
                    y2 = 0.7
                ), payload={ 'count': 0 })
            ])
            for key in bboxes
        })

        count_ge_5 = counts_per_frame \
            .filter(lambda intrvl: intrvl['payload']['count'] >= 5) \
            .coalesce(
                ('t1', 't2'),
                bounds_merge_op = Bounds3D.span,
                predicate = iou_at_least(0.9),
                epsilon = 0
            )

        count_lt_5 = base_ism.minus(count_ge_5).filter_size(min_size = 0.5)

    ls5_gt20 = count_lt_5.join(
        count_gt_20,
        predicate = Bounds3D.T(before(min_dist=0, max_dist=10)),
        merge_op = lambda interval1, interval2: Interval(
            interval1['bounds'].span(interval2['bounds'])
        ),
        window = 10.0,
        progress_bar = True
    )

    ls5_gt20_ls5 = ls5_gt20.join(
        count_lt_5,
        predicate = Bounds3D.T(before(min_dist=0, max_dist=10)),
        merge_op = lambda interval1, interval2: Interval(
            interval1['bounds'].span(interval2['bounds'])
        ),
        window = 10.0,
        progress_bar = True
    ).filter_size(max_size = 10)

    tok = time.time()

    print("query time: ", tok - tik)

    # Print query results
    res = []
    for k in ls5_gt20_ls5:
        intervals = ls5_gt20_ls5[k].get_intervals()
        for interval in intervals:
            res.append((k, interval['t1'], interval['t2']))

    print(res)
    print(len(res))

if __name__ == '__main__':
    query3()
    # Query 2 w/o optimization
    # query2()
    # Query 2 w/ optimization
    # query2(True)

# Stats
"""
fps 30, 5 videos: 
tik = time.time()
bboxes = get_maskrcnn_bboxes()

car = bboxes.filter(lambda interval: interval['payload']['class'] == 'car')
truck = bboxes.filter(lambda interval: interval['payload']['class'] == 'truck')

car_trackings = car.coalesce(
    ('t1', 't2'),
    bounds_merge_op = Bounds3D.span,
    predicate = iou_at_least(0.5),
    epsilon = 0
)

car_trackings_filtered = car_trackings.filter_size(
    min_size = 1
)

truck_trackings = truck.coalesce(
    ('t1', 't2'),
    bounds_merge_op = Bounds3D.span,
    predicate = iou_at_least(0.5),
    epsilon = 0
)

truck_trackings_filtered = truck_trackings.filter_size(
    min_size = 1
)

truck_before_car = truck_trackings_filtered.join(
    car_trackings_filtered,
    predicate = Bounds3D.T(before(min_dist=0, max_dist=10)),
    merge_op = lambda interval1, interval2: Interval(
        interval1['bounds'].span(interval2['bounds'])
    ),
    window = 10.0,
    progress_bar = True
)
tok = time.time()

print("query time: ", tok - tik)


query time:  12.021287202835083
[(0, 36.45453311166528, 40.123333333333335), (1, 0.0, 4.266843853820598), (1, 0.0, 5.233550664451827), (1, 0.0, 5.866910299003322), (1, 0.0, 6.766947674418605), (1, 0.0, 7.166964285714286), (1, 0.0, 8.600357142857144), (1, 0.0, 9.433725083056478), (1, 0.0, 9.967080564784053), (1, 0.0, 11.600481727574751), (1, 0.0, 12.600523255813954), (1, 0.0, 12.633857973421927), (1, 1.3667234219269104, 5.233550664451827), (1, 1.3667234219269104, 5.866910299003322), (1, 1.3667234219269104, 6.766947674418605), (1, 1.3667234219269104, 7.166964285714286), (1, 1.3667234219269104, 8.600357142857144), (1, 1.3667234219269104, 9.433725083056478), (1, 1.3667234219269104, 9.967080564784053), (1, 1.3667234219269104, 11.600481727574751), (1, 1.3667234219269104, 12.600523255813954), (1, 1.3667234219269104, 12.633857973421927), (1, 1.3667234219269104, 12.700527408637875), (1, 10.333762458471762, 12.700527408637875), (1, 10.333762458471762, 14.467267441860466), (1, 10.333762458471762, 15.167296511627908), (1, 10.333762458471762, 16.000664451827245), (1, 10.333762458471762, 16.500685215946845), (1, 10.333762458471762, 17.500726744186046), (1, 10.333762458471762, 18.067416943521597), (1, 10.333762458471762, 18.634107142857143), (1, 10.333762458471762, 19.96749584717608), (1, 10.333762458471762, 20.500851328903654), (1, 10.333762458471762, 20.934202657807308), (1, 10.333762458471762, 21.000872093023258), (1, 10.333762458471762, 21.800905315614617), (1, 10.333762458471762, 22.434264950166114), (1, 10.333762458471762, 22.767612126245847), (1, 10.333762458471762, 25.134377076411962), (1, 16.96737126245847, 19.96749584717608), (1, 16.96737126245847, 20.500851328903654), (1, 16.96737126245847, 20.934202657807308), (1, 16.96737126245847, 21.000872093023258), (1, 16.96737126245847, 21.800905315614617), (1, 16.96737126245847, 22.434264950166114), (1, 16.96737126245847, 22.767612126245847), (1, 16.96737126245847, 23.734318936877077), (1, 16.96737126245847, 23.767653654485052), (1, 16.96737126245847, 24.134335548172757), (1, 16.96737126245847, 24.701025747508307), (1, 16.96737126245847, 25.134377076411962), (1, 16.96737126245847, 25.367720099667775), (1, 16.96737126245847, 26.801112956810634), (1, 16.96737126245847, 27.534476744186048), (1, 16.96737126245847, 27.63448089700997), (1, 16.96737126245847, 27.73448504983389), (1, 16.96737126245847, 27.86782392026578), (1, 16.96737126245847, 28.667857142857144), (1, 16.96737126245847, 29.667898671096346), (1, 16.96737126245847, 30.334593023255817), (1, 17.967412790697676, 20.934202657807308), (1, 17.967412790697676, 21.800905315614617), (1, 17.967412790697676, 22.434264950166114), (1, 17.967412790697676, 22.767612126245847), (1, 17.967412790697676, 23.734318936877077), (1, 17.967412790697676, 23.767653654485052), (1, 17.967412790697676, 24.134335548172757), (1, 17.967412790697676, 24.701025747508307), (1, 17.967412790697676, 25.134377076411962), (1, 17.967412790697676, 25.367720099667775), (1, 17.967412790697676, 26.801112956810634), (1, 17.967412790697676, 27.534476744186048), (1, 17.967412790697676, 27.63448089700997), (1, 17.967412790697676, 27.73448504983389), (1, 17.967412790697676, 27.86782392026578), (1, 17.967412790697676, 28.667857142857144), (1, 17.967412790697676, 29.667898671096346), (1, 17.967412790697676, 29.867906976744187), (1, 17.967412790697676, 30.334593023255817), (1, 24.93436877076412, 27.73448504983389), (1, 24.93436877076412, 27.86782392026578), (1, 24.93436877076412, 29.667898671096346), (1, 24.93436877076412, 29.867906976744187), (1, 24.93436877076412, 31.334634551495018), (1, 24.93436877076412, 31.66798172757475), (1, 24.93436877076412, 32.501349667774086), (1, 24.93436877076412, 35.334800664451826), (1, 24.93436877076412, 35.96816029900332), (1, 24.93436877076412, 36.168168604651164), (1, 24.93436877076412, 36.334842192691035), (1, 24.93436877076412, 36.93486710963455), (1, 24.93436877076412, 36.968201827242524), (1, 24.93436877076412, 40.135000000000005), (1, 24.93436877076412, 40.135000000000005), (2, 7.565094208922139, 11.131019673039622), (2, 7.565094208922139, 12.130811859240787), (2, 7.565094208922139, 13.230583264062068), (2, 7.565094208922139, 13.4305417013023), (2, 7.565094208922139, 13.730479357162649), (2, 7.565094208922139, 15.363473261291217), (2, 7.565094208922139, 15.396799667497922), (2, 7.565094208922139, 15.69673732335827), (2, 7.565094208922139, 16.529897478525907), (2, 7.565094208922139, 17.896280133000833), (2, 7.565094208922139, 17.896280133000833), (2, 7.565094208922139, 17.929606539207537), (2, 7.565094208922139, 18.962725131615407), (2, 7.565094208922139, 20.062496536436687), (2, 7.565094208922139, 23.195178719867), (2, 27.327653089498476, 33.02646855084511), (2, 27.327653089498476, 34.392851205320035), (2, 27.327653089498476, 35.89253948462178), (2, 27.327653089498476, 38.4586727625381), (2, 27.327653089498476, 38.558651981158214), (2, 27.327653089498476, 38.991895261845386), (2, 27.327653089498476, 39.02522166805209), (2, 27.327653089498476, 39.79172901080632), (2, 27.327653089498476, 40.09166666666667), (4, 0.03324793388429752, 4.189239669421488), (4, 0.03324793388429752, 4.787702479338843), (4, 0.03324793388429752, 5.5191570247933885), (4, 0.03324793388429752, 5.618900826446281), (4, 0.03324793388429752, 6.948818181818182), (4, 0.03324793388429752, 7.24804958677686), (4, 0.03324793388429752, 7.281297520661157), (4, 0.03324793388429752, 8.112495867768596), (4, 0.03324793388429752, 8.611214876033058), (4, 0.03324793388429752, 9.242925619834711), (4, 0.03324793388429752, 9.808140495867768), (4, 0.03324793388429752, 10.539595041322315), (4, 0.03324793388429752, 11.769768595041322), (4, 2.2608595041322315, 5.5191570247933885), (4, 2.2608595041322315, 5.618900826446281), (4, 2.2608595041322315, 6.948818181818182), (4, 2.2608595041322315, 7.24804958677686), (4, 2.2608595041322315, 7.281297520661157), (4, 2.2608595041322315, 8.112495867768596), (4, 2.2608595041322315, 8.611214876033058), (4, 2.2608595041322315, 9.242925619834711), (4, 2.2608595041322315, 9.808140495867768), (4, 2.2608595041322315, 10.539595041322315), (4, 2.2608595041322315, 11.769768595041322), (4, 2.2608595041322315, 15.393793388429753)]
143

fps 15, 5 videos: 
query time:  6.325680494308472
[(0, 36.48788584095317, 40.156686062621226), (1, 0.0, 3.066794019933555), (1, 0.0, 4.066835548172758), (1, 0.0, 4.466852159468439), (1, 0.0, 6.33359634551495), (1, 0.0, 6.466935215946844), (1, 0.0, 6.933621262458472), (1, 0.0, 8.333679401993356), (1, 0.0, 9.067043189368771), (1, 0.0, 9.800406976744187), (1, 0.0, 10.13375415282392), (1, 0.0, 11.400473421926911), (1, 0.0, 11.667151162790699), (1, 0.0, 12.133837209302326), (1, 0.0, 12.533853820598008), (1, 1.4000581395348837, 4.066835548172758), (1, 1.4000581395348837, 4.466852159468439), (1, 1.4000581395348837, 6.33359634551495), (1, 1.4000581395348837, 6.466935215946844), (1, 1.4000581395348837, 6.933621262458472), (1, 1.4000581395348837, 8.333679401993356), (1, 1.4000581395348837, 9.067043189368771), (1, 1.4000581395348837, 9.800406976744187), (1, 1.4000581395348837, 10.13375415282392), (1, 1.4000581395348837, 11.400473421926911), (1, 1.4000581395348837, 11.667151162790699), (1, 1.4000581395348837, 12.133837209302326), (1, 1.4000581395348837, 12.533853820598008), (1, 1.4000581395348837, 12.867200996677742), (1, 9.067043189368771, 11.400473421926911), (1, 9.067043189368771, 11.667151162790699), (1, 9.067043189368771, 12.533853820598008), (1, 9.067043189368771, 12.867200996677742), (1, 9.067043189368771, 13.53389534883721), (1, 9.067043189368771, 14.733945182724254), (1, 9.067043189368771, 14.933953488372094), (1, 9.067043189368771, 15.067292358803988), (1, 9.067043189368771, 16.134003322259137), (1, 9.067043189368771, 16.534019933554816), (1, 9.067043189368771, 17.200714285714287), (1, 9.067043189368771, 17.667400332225913), (1, 9.067043189368771, 18.334094684385384), (1, 9.067043189368771, 20.934202657807308), (1, 9.067043189368771, 21.067541528239204), (1, 9.067043189368771, 21.400888704318938), (1, 10.267093023255814, 12.867200996677742), (1, 10.267093023255814, 13.53389534883721), (1, 10.267093023255814, 14.733945182724254), (1, 10.267093023255814, 14.933953488372094), (1, 10.267093023255814, 15.067292358803988), (1, 10.267093023255814, 16.134003322259137), (1, 10.267093023255814, 16.534019933554816), (1, 10.267093023255814, 17.200714285714287), (1, 10.267093023255814, 17.667400332225913), (1, 10.267093023255814, 18.334094684385384), (1, 10.267093023255814, 20.934202657807308), (1, 10.267093023255814, 21.067541528239204), (1, 10.267093023255814, 21.400888704318938), (1, 10.267093023255814, 22.46759966777409), (1, 10.267093023255814, 25.134377076411962), (1, 13.33388704318937, 16.134003322259137), (1, 13.33388704318937, 16.134003322259137), (1, 13.33388704318937, 16.534019933554816), (1, 13.33388704318937, 16.534019933554816), (1, 13.33388704318937, 17.200714285714287), (1, 13.33388704318937, 17.200714285714287), (1, 13.33388704318937, 17.667400332225913), (1, 13.33388704318937, 17.667400332225913), (1, 13.33388704318937, 18.334094684385384), (1, 13.33388704318937, 18.334094684385384), (1, 13.33388704318937, 20.934202657807308), (1, 13.33388704318937, 20.934202657807308), (1, 13.33388704318937, 21.067541528239204), (1, 13.33388704318937, 21.067541528239204), (1, 13.33388704318937, 21.400888704318938), (1, 13.33388704318937, 21.400888704318938), (1, 13.33388704318937, 22.46759966777409), (1, 13.33388704318937, 22.46759966777409), (1, 13.33388704318937, 23.734318936877077), (1, 13.33388704318937, 23.734318936877077), (1, 13.33388704318937, 23.800988372093023), (1, 13.33388704318937, 23.800988372093023), (1, 13.33388704318937, 24.93436877076412), (1, 13.33388704318937, 24.93436877076412), (1, 13.33388704318937, 25.134377076411962), (1, 13.33388704318937, 25.134377076411962), (1, 13.33388704318937, 25.40105481727575), (1, 13.33388704318937, 25.40105481727575), (1, 13.33388704318937, 27.66781561461794), (1, 13.33388704318937, 27.66781561461794), (1, 13.33388704318937, 28.467848837209303), (1, 13.33388704318937, 28.467848837209303), (1, 17.000705980066446, 20.934202657807308), (1, 17.000705980066446, 21.067541528239204), (1, 17.000705980066446, 21.400888704318938), (1, 17.000705980066446, 22.46759966777409), (1, 17.000705980066446, 23.734318936877077), (1, 17.000705980066446, 23.800988372093023), (1, 17.000705980066446, 24.93436877076412), (1, 17.000705980066446, 25.134377076411962), (1, 17.000705980066446, 25.40105481727575), (1, 17.000705980066446, 26.801112956810634), (1, 17.000705980066446, 27.534476744186048), (1, 17.000705980066446, 27.66781561461794), (1, 17.000705980066446, 27.73448504983389), (1, 17.000705980066446, 27.801154485049835), (1, 17.000705980066446, 27.86782392026578), (1, 17.000705980066446, 28.467848837209303), (1, 17.000705980066446, 28.867865448504986), (1, 17.000705980066446, 29.401220930232558), (1, 18.000747508305647, 20.934202657807308), (1, 18.000747508305647, 21.067541528239204), (1, 18.000747508305647, 21.400888704318938), (1, 18.000747508305647, 22.46759966777409), (1, 18.000747508305647, 23.734318936877077), (1, 18.000747508305647, 23.800988372093023), (1, 18.000747508305647, 24.93436877076412), (1, 18.000747508305647, 25.134377076411962), (1, 18.000747508305647, 25.40105481727575), (1, 18.000747508305647, 26.801112956810634), (1, 18.000747508305647, 27.534476744186048), (1, 18.000747508305647, 27.66781561461794), (1, 18.000747508305647, 27.73448504983389), (1, 18.000747508305647, 27.801154485049835), (1, 18.000747508305647, 27.86782392026578), (1, 18.000747508305647, 28.467848837209303), (1, 18.000747508305647, 28.867865448504986), (1, 18.000747508305647, 29.401220930232558), (1, 18.000747508305647, 29.667898671096346), (1, 18.000747508305647, 29.867906976744187), (1, 18.000747508305647, 30.334593023255817), (1, 18.000747508305647, 31.001287375415284), (1, 22.46759966777409, 24.93436877076412), (1, 22.46759966777409, 25.40105481727575), (1, 22.46759966777409, 26.801112956810634), (1, 22.46759966777409, 27.534476744186048), (1, 22.46759966777409, 27.73448504983389), (1, 22.46759966777409, 27.801154485049835), (1, 22.46759966777409, 27.86782392026578), (1, 22.46759966777409, 28.467848837209303), (1, 22.46759966777409, 28.867865448504986), (1, 22.46759966777409, 29.401220930232558), (1, 22.46759966777409, 29.667898671096346), (1, 22.46759966777409, 29.867906976744187), (1, 22.46759966777409, 30.334593023255817), (1, 22.46759966777409, 31.001287375415284), (1, 22.46759966777409, 31.734651162790698), (1, 22.46759966777409, 32.468014950166115), (1, 22.46759966777409, 35.334800664451826), (1, 22.46759966777409, 36.001495016611294), (1, 22.46759966777409, 37.0015365448505), (1, 22.46759966777409, 40.135000000000005), (1, 24.93436877076412, 27.86782392026578), (1, 24.93436877076412, 28.867865448504986), (1, 24.93436877076412, 29.401220930232558), (1, 24.93436877076412, 29.667898671096346), (1, 24.93436877076412, 29.867906976744187), (1, 24.93436877076412, 30.334593023255817), (1, 24.93436877076412, 31.001287375415284), (1, 24.93436877076412, 31.734651162790698), (1, 24.93436877076412, 32.468014950166115), (1, 24.93436877076412, 35.334800664451826), (1, 24.93436877076412, 35.53480897009967), (1, 24.93436877076412, 36.001495016611294), (1, 24.93436877076412, 36.46818106312293), (1, 24.93436877076412, 36.93486710963455), (1, 24.93436877076412, 37.0015365448505), (1, 24.93436877076412, 40.135000000000005), (1, 24.93436877076412, 40.135000000000005), (1, 36.001495016611294, 40.135000000000005), (1, 36.001495016611294, 40.135000000000005), (1, 36.001495016611294, 40.135000000000005), (2, 7.598420615128845, 10.597797173732335), (2, 7.598420615128845, 12.33077029648102), (2, 7.598420615128845, 12.397423108894431), (2, 7.598420615128845, 13.663826544749238), (2, 7.598420615128845, 13.730479357162649), (2, 7.598420615128845, 15.063535605430868), (2, 7.598420615128845, 15.396799667497922), (2, 7.598420615128845, 15.730063729564977), (2, 7.598420615128845, 17.862953726794125), (2, 7.598420615128845, 17.99625935162095), (2, 7.598420615128845, 18.12956497644777), (2, 7.598420615128845, 19.46262122471599), (2, 7.598420615128845, 20.662371848157385), (2, 7.598420615128845, 23.195178719867), (2, 27.127694652258242, 31.593433083956775), (2, 27.127694652258242, 33.12644776946522), (2, 27.127694652258242, 34.72611526738709), (2, 27.127694652258242, 36.25912995289554), (2, 27.127694652258242, 38.4586727625381), (2, 27.127694652258242, 38.79193682460515), (2, 27.127694652258242, 38.991895261845386), (2, 27.127694652258242, 39.058548074258795), (2, 27.127694652258242, 40.12499307287337), (2, 27.127694652258242, 40.12499307287337), (4, 0.06649586776859504, 2.5933388429752067), (4, 0.06649586776859504, 4.189239669421488), (4, 0.06649586776859504, 4.787702479338843), (4, 0.06649586776859504, 5.5191570247933885), (4, 0.06649586776859504, 6.982066115702479), (4, 0.06649586776859504, 7.181553719008265), (4, 0.06649586776859504, 7.3145454545454545), (4, 0.06649586776859504, 8.112495867768596), (4, 0.06649586776859504, 8.311983471074381), (4, 0.06649586776859504, 8.777454545454546), (4, 0.06649586776859504, 9.176429752066115), (4, 0.06649586776859504, 9.841388429752067), (4, 0.06649586776859504, 10.572842975206612), (4, 0.06649586776859504, 10.971818181818183), (4, 0.06649586776859504, 11.769768595041322)]
211

skip 1 frame for every 5 frames, 5 videos:
query time:  9.797258615493774
[(0, 36.4795476586312, 40.14834788029925), (1, 0.0, 3.5001453488372096), (1, 0.0, 3.5001453488372096), (1, 0.0, 4.833534053156146), (1, 0.0, 4.9585392441860465), (1, 0.0, 5.333554817275748), (1, 0.0, 6.33359634551495), (1, 0.0, 6.33359634551495), (1, 0.0, 7.166964285714286), (1, 0.0, 8.333679401993356), (1, 0.0, 9.458726121262458), (1, 0.0, 10.000415282392026), (1, 0.0, 10.500436046511629), (1, 0.0, 11.625482765780731), (1, 0.0, 12.333845514950166), (1, 0.0, 12.500519102990033), (1, 1.3750571013289037, 4.833534053156146), (1, 1.3750571013289037, 4.9585392441860465), (1, 1.3750571013289037, 5.333554817275748), (1, 1.3750571013289037, 6.33359634551495), (1, 1.3750571013289037, 6.33359634551495), (1, 1.3750571013289037, 7.166964285714286), (1, 1.3750571013289037, 8.333679401993356), (1, 1.3750571013289037, 9.458726121262458), (1, 1.3750571013289037, 10.000415282392026), (1, 1.3750571013289037, 10.500436046511629), (1, 1.3750571013289037, 11.625482765780731), (1, 1.3750571013289037, 12.333845514950166), (1, 1.3750571013289037, 12.500519102990033), (1, 1.3750571013289037, 12.708861088039868), (1, 1.3750571013289037, 13.500560631229236), (1, 10.292094061461794, 12.708861088039868), (1, 10.292094061461794, 13.500560631229236), (1, 10.292094061461794, 14.50060215946844), (1, 10.292094061461794, 15.167296511627908), (1, 10.292094061461794, 15.667317275747509), (1, 10.292094061461794, 16.500685215946845), (1, 10.292094061461794, 17.500726744186046), (1, 10.292094061461794, 17.667400332225913), (1, 10.292094061461794, 18.334094684385384), (1, 10.292094061461794, 20.500851328903654), (1, 10.292094061461794, 20.95920369601329), (1, 10.292094061461794, 21.625898048172758), (1, 10.292094061461794, 22.459265988372096), (1, 10.292094061461794, 22.79261316445183), (1, 17.000705980066446, 20.500851328903654), (1, 17.000705980066446, 20.95920369601329), (1, 17.000705980066446, 21.625898048172758), (1, 17.000705980066446, 22.459265988372096), (1, 17.000705980066446, 22.79261316445183), (1, 17.000705980066446, 23.500975913621264), (1, 17.000705980066446, 23.750986295681063), (1, 17.000705980066446, 24.167670265780732), (1, 17.000705980066446, 24.7093594269103), (1, 17.000705980066446, 25.167711794019933), (1, 17.000705980066446, 25.376053779069768), (1, 17.000705980066446, 26.417763704318936), (1, 17.000705980066446, 26.834447674418605), (1, 17.000705980066446, 27.54281042358804), (1, 17.000705980066446, 27.709484011627907), (1, 17.000705980066446, 27.751152408637875), (1, 17.000705980066446, 27.876157599667774), (1, 17.000705980066446, 28.001162790697677), (1, 17.000705980066446, 29.50122508305648), (1, 17.000705980066446, 29.834572259136213), (1, 18.000747508305647, 20.95920369601329), (1, 18.000747508305647, 21.625898048172758), (1, 18.000747508305647, 22.459265988372096), (1, 18.000747508305647, 22.79261316445183), (1, 18.000747508305647, 23.500975913621264), (1, 18.000747508305647, 23.750986295681063), (1, 18.000747508305647, 24.167670265780732), (1, 18.000747508305647, 24.7093594269103), (1, 18.000747508305647, 25.167711794019933), (1, 18.000747508305647, 25.376053779069768), (1, 18.000747508305647, 26.417763704318936), (1, 18.000747508305647, 26.834447674418605), (1, 18.000747508305647, 27.54281042358804), (1, 18.000747508305647, 27.709484011627907), (1, 18.000747508305647, 27.751152408637875), (1, 18.000747508305647, 27.876157599667774), (1, 18.000747508305647, 28.001162790697677), (1, 18.000747508305647, 29.50122508305648), (1, 18.000747508305647, 29.834572259136213), (1, 18.000747508305647, 29.834572259136213), (1, 24.959369808970102, 27.876157599667774), (1, 24.959369808970102, 29.50122508305648), (1, 24.959369808970102, 29.834572259136213), (1, 24.959369808970102, 30.91795058139535), (1, 24.959369808970102, 31.29296615448505), (1, 24.959369808970102, 31.79298691860465), (1, 24.959369808970102, 32.501349667774086), (1, 24.959369808970102, 35.334800664451826), (1, 24.959369808970102, 36.001495016611294), (1, 24.959369808970102, 36.2515053986711), (1, 24.959369808970102, 36.376510589701), (1, 24.959369808970102, 36.95986814784053), (1, 24.959369808970102, 37.0015365448505), (1, 24.959369808970102, 40.168334717607976), (1, 24.959369808970102, 40.168334717607976), (2, 7.581757412025492, 10.539475962870602), (2, 7.581757412025492, 10.872740024937656), (2, 7.581757412025492, 12.372428304239401), (2, 7.581757412025492, 12.414086311997783), (2, 7.581757412025492, 12.99729842061513), (2, 7.581757412025492, 13.788800568024383), (2, 7.581757412025492, 14.83025076198393), (2, 7.581757412025492, 15.496778886118038), (2, 7.581757412025492, 15.621752909393184), (2, 7.581757412025492, 17.871285328345802), (2, 7.581757412025492, 17.871285328345802), (2, 7.581757412025492, 18.03791735937933), (2, 7.581757412025492, 19.037709545580494), (2, 7.581757412025492, 20.07915973954004), (2, 7.581757412025492, 23.203510321418676), (2, 27.119363050706568, 32.74319409808811), (2, 27.119363050706568, 33.034800152396784), (2, 27.119363050706568, 34.28454038514824), (2, 27.119363050706568, 35.784228664449984), (2, 27.119363050706568, 38.283709129952896), (2, 27.119363050706568, 38.57531518426157), (2, 27.119363050706568, 38.825263230811856), (2, 27.119363050706568, 39.03355326960377), (2, 27.119363050706568, 39.07521127736215), (2, 27.119363050706568, 40.1166614713217), (4, 0.0415599173553719, 4.197551652892562), (4, 0.0415599173553719, 4.820950413223141), (4, 0.0415599173553719, 5.6521487603305784), (4, 0.0415599173553719, 5.6521487603305784), (4, 0.0415599173553719, 6.982066115702479), (4, 0.0415599173553719, 7.189865702479339), (4, 0.0415599173553719, 7.3145454545454545), (4, 0.0415599173553719, 8.145743801652893), (4, 0.0415599173553719, 8.228863636363636), (4, 0.0415599173553719, 9.226301652892563), (4, 0.0415599173553719, 9.267861570247934), (4, 0.0415599173553719, 10.556219008264463), (4, 0.0415599173553719, 10.680898760330578), (4, 0.0415599173553719, 11.80301652892562), (4, 0.0415599173553719, 11.80301652892562), (4, 2.2857954545454544, 5.6521487603305784), (4, 2.2857954545454544, 5.6521487603305784), (4, 2.2857954545454544, 6.982066115702479), (4, 2.2857954545454544, 7.189865702479339), (4, 2.2857954545454544, 7.3145454545454545), (4, 2.2857954545454544, 8.145743801652893), (4, 2.2857954545454544, 8.228863636363636), (4, 2.2857954545454544, 9.226301652892563), (4, 2.2857954545454544, 9.267861570247934), (4, 2.2857954545454544, 10.556219008264463), (4, 2.2857954545454544, 10.680898760330578), (4, 2.2857954545454544, 11.80301652892562), (4, 2.2857954545454544, 11.80301652892562), (4, 2.2857954545454544, 15.418729338842976)]
154

skip 1 frame for every 10 frames, 5 videos:
query time:  11.083552360534668
[(0, 36.46565068809458, 40.13445090976263), (1, 0.0, 3.6668189368770765), (1, 0.0, 5.2594776670358065), (1, 0.0, 5.333554817275748), (1, 0.0, 6.33359634551495), (1, 0.0, 6.33359634551495), (1, 0.0, 7.185483573274271), (1, 0.0, 8.333679401993356), (1, 0.0, 9.44483665559247), (1, 0.0, 10.000415282392026), (1, 0.0, 11.630112587670729), (1, 0.0, 12.333845514950166), (1, 0.0, 12.630154115909932), (1, 1.3704272794389074, 5.2594776670358065), (1, 1.3704272794389074, 5.333554817275748), (1, 1.3704272794389074, 6.33359634551495), (1, 1.3704272794389074, 6.33359634551495), (1, 1.3704272794389074, 7.185483573274271), (1, 1.3704272794389074, 8.333679401993356), (1, 1.3704272794389074, 9.44483665559247), (1, 1.3704272794389074, 10.000415282392026), (1, 1.3704272794389074, 11.630112587670729), (1, 1.3704272794389074, 12.333845514950166), (1, 1.3704272794389074, 12.630154115909932), (1, 1.3704272794389074, 12.70423126614987), (1, 10.296723883351792, 12.70423126614987), (1, 10.296723883351792, 14.482082871908455), (1, 10.296723883351792, 15.185815799187893), (1, 10.296723883351792, 15.667317275747509), (1, 10.296723883351792, 16.51920450350683), (1, 10.296723883351792, 17.519246031746032), (1, 10.296723883351792, 17.667400332225913), (1, 10.296723883351792, 18.334094684385384), (1, 10.296723883351792, 20.51937061646364), (1, 10.296723883351792, 20.667524916943524), (1, 10.296723883351792, 20.963833517903286), (1, 10.296723883351792, 21.037910668143226), (1, 10.296723883351792, 22.445376522702105), (1, 10.296723883351792, 22.77872369878184), (1, 10.296723883351792, 25.14919250645995), (1, 17.000705980066446, 20.51937061646364), (1, 17.000705980066446, 20.667524916943524), (1, 17.000705980066446, 20.963833517903286), (1, 17.000705980066446, 21.037910668143226), (1, 17.000705980066446, 22.445376522702105), (1, 17.000705980066446, 22.77872369878184), (1, 17.000705980066446, 23.741726651901068), (1, 17.000705980066446, 23.778765227021044), (1, 17.000705980066446, 24.149150978220746), (1, 17.000705980066446, 24.704729605020304), (1, 17.000705980066446, 25.14919250645995), (1, 17.000705980066446, 25.371423957179772), (1, 17.000705980066446, 26.81592838685862), (1, 17.000705980066446, 27.556699889258027), (1, 17.000705980066446, 27.66781561461794), (1, 17.000705980066446, 27.74189276485788), (1, 17.000705980066446, 27.890047065337765), (1, 17.000705980066446, 28.001162790697677), (1, 17.000705980066446, 29.667898671096346), (1, 17.000705980066446, 30.334593023255817), (1, 18.000747508305647, 20.963833517903286), (1, 18.000747508305647, 21.037910668143226), (1, 18.000747508305647, 22.445376522702105), (1, 18.000747508305647, 22.77872369878184), (1, 18.000747508305647, 23.741726651901068), (1, 18.000747508305647, 23.778765227021044), (1, 18.000747508305647, 24.149150978220746), (1, 18.000747508305647, 24.704729605020304), (1, 18.000747508305647, 25.14919250645995), (1, 18.000747508305647, 25.371423957179772), (1, 18.000747508305647, 26.81592838685862), (1, 18.000747508305647, 27.556699889258027), (1, 18.000747508305647, 27.66781561461794), (1, 18.000747508305647, 27.74189276485788), (1, 18.000747508305647, 27.890047065337765), (1, 18.000747508305647, 28.001162790697677), (1, 18.000747508305647, 29.667898671096346), (1, 18.000747508305647, 29.890130121816167), (1, 18.000747508305647, 30.334593023255817), (1, 24.963999630860098, 27.890047065337765), (1, 24.963999630860098, 29.667898671096346), (1, 24.963999630860098, 29.890130121816167), (1, 24.963999630860098, 31.334634551495018), (1, 24.963999630860098, 31.66798172757475), (1, 24.963999630860098, 32.519868955334076), (1, 24.963999630860098, 35.07553063861204), (1, 24.963999630860098, 35.334800664451826), (1, 24.963999630860098, 36.001495016611294), (1, 24.963999630860098, 36.186687892211154), (1, 24.963999630860098, 36.371880767811), (1, 24.963999630860098, 36.96449796973053), (1, 24.963999630860098, 37.0015365448505), (1, 24.963999630860098, 40.14981543004799), (1, 24.963999630860098, 40.14981543004799), (2, 7.59101474708291, 10.886626027523784), (2, 7.59101474708291, 12.33077029648102), (2, 7.59101474708291, 12.99729842061513), (2, 7.59101474708291, 13.737885225208585), (2, 7.59101474708291, 13.737885225208585), (2, 7.59101474708291, 15.404205535543857), (2, 7.59101474708291, 15.404205535543857), (2, 7.59101474708291, 15.478264216003202), (2, 7.59101474708291, 16.55211508266371), (2, 7.59101474708291, 17.88517133093193), (2, 7.59101474708291, 17.922200671161605), (2, 7.59101474708291, 17.922200671161605), (2, 7.59101474708291, 19.033080878051784), (2, 7.59101474708291, 20.06990240448262), (2, 7.59101474708291, 23.217396324004802), (2, 27.10547704812044, 33.03017148486808), (2, 27.10547704812044, 34.400257073365964), (2, 27.10547704812044, 35.918460022782554), (2, 27.10547704812044, 38.473484498629965), (2, 27.10547704812044, 38.58457251931899), (2, 27.10547704812044, 39.02892460207506), (2, 27.10547704812044, 39.06595394230473), (2, 27.10547704812044, 39.806540746898186), (2, 27.10547704812044, 40.102775468735565), (4, 0.03694214876033058, 4.2114049586776865), (4, 0.03694214876033058, 4.802479338842976), (4, 0.03694214876033058, 5.541322314049586), (4, 0.03694214876033058, 5.6521487603305784), (4, 0.03694214876033058, 6.982066115702479), (4, 0.03694214876033058, 7.203719008264462), (4, 0.03694214876033058, 7.3145454545454545), (4, 0.03694214876033058, 8.127272727272727), (4, 0.03694214876033058, 8.238099173553719), (4, 0.03694214876033058, 8.792231404958677), (4, 0.03694214876033058, 9.161652892561984), (4, 0.03694214876033058, 9.272479338842976), (4, 0.03694214876033058, 9.900495867768594), (4, 0.03694214876033058, 10.565454545454545), (4, 0.03694214876033058, 11.784545454545455), (4, 2.290413223140496, 5.541322314049586), (4, 2.290413223140496, 5.6521487603305784), (4, 2.290413223140496, 6.982066115702479), (4, 2.290413223140496, 7.203719008264462), (4, 2.290413223140496, 7.3145454545454545), (4, 2.290413223140496, 8.127272727272727), (4, 2.290413223140496, 8.238099173553719), (4, 2.290413223140496, 8.792231404958677), (4, 2.290413223140496, 9.161652892561984), (4, 2.290413223140496, 9.272479338842976), (4, 2.290413223140496, 9.900495867768594), (4, 2.290413223140496, 10.565454545454545), (4, 2.290413223140496, 11.784545454545455), (4, 2.290413223140496, 13.668595041322313), (4, 2.290413223140496, 15.404876033057851)]
148

binary search, 5 videos:
query time:  4.051605701446533
[(0, 36.45453311166528, 40.123333333333335), (1, 0.0, 4.266843853820598), (1, 0.0, 5.233550664451827), (1, 0.0, 5.866910299003322), (1, 0.0, 6.766947674418605), (1, 0.0, 7.166964285714286), (1, 0.0, 8.600357142857144), (1, 0.0, 9.433725083056478), (1, 0.0, 9.967080564784053), (1, 0.0, 11.600481727574751), (1, 0.0, 12.600523255813954), (1, 0.0, 12.633857973421927), (1, 1.3667234219269104, 5.233550664451827), (1, 1.3667234219269104, 5.866910299003322), (1, 1.3667234219269104, 6.766947674418605), (1, 1.3667234219269104, 7.166964285714286), (1, 1.3667234219269104, 8.600357142857144), (1, 1.3667234219269104, 9.433725083056478), (1, 1.3667234219269104, 9.967080564784053), (1, 1.3667234219269104, 11.600481727574751), (1, 1.3667234219269104, 12.600523255813954), (1, 1.3667234219269104, 12.633857973421927), (1, 1.3667234219269104, 12.700527408637875), (1, 10.333762458471762, 12.700527408637875), (1, 10.333762458471762, 14.467267441860466), (1, 10.333762458471762, 15.167296511627908), (1, 10.333762458471762, 16.000664451827245), (1, 10.333762458471762, 16.500685215946845), (1, 10.333762458471762, 17.500726744186046), (1, 10.333762458471762, 18.067416943521597), (1, 10.333762458471762, 18.634107142857143), (1, 10.333762458471762, 19.96749584717608), (1, 10.333762458471762, 20.500851328903654), (1, 10.333762458471762, 20.934202657807308), (1, 10.333762458471762, 21.000872093023258), (1, 10.333762458471762, 21.800905315614617), (1, 10.333762458471762, 22.434264950166114), (1, 10.333762458471762, 22.767612126245847), (1, 10.333762458471762, 25.134377076411962), (1, 16.96737126245847, 19.96749584717608), (1, 16.96737126245847, 20.500851328903654), (1, 16.96737126245847, 20.934202657807308), (1, 16.96737126245847, 21.000872093023258), (1, 16.96737126245847, 21.800905315614617), (1, 16.96737126245847, 22.434264950166114), (1, 16.96737126245847, 22.767612126245847), (1, 16.96737126245847, 23.734318936877077), (1, 16.96737126245847, 23.767653654485052), (1, 16.96737126245847, 24.134335548172757), (1, 16.96737126245847, 24.701025747508307), (1, 16.96737126245847, 25.134377076411962), (1, 16.96737126245847, 25.367720099667775), (1, 16.96737126245847, 26.801112956810634), (1, 16.96737126245847, 27.534476744186048), (1, 16.96737126245847, 27.63448089700997), (1, 16.96737126245847, 27.73448504983389), (1, 16.96737126245847, 27.86782392026578), (1, 16.96737126245847, 28.667857142857144), (1, 16.96737126245847, 29.667898671096346), (1, 16.96737126245847, 30.334593023255817), (1, 17.967412790697676, 20.934202657807308), (1, 17.967412790697676, 21.800905315614617), (1, 17.967412790697676, 22.434264950166114), (1, 17.967412790697676, 22.767612126245847), (1, 17.967412790697676, 23.734318936877077), (1, 17.967412790697676, 23.767653654485052), (1, 17.967412790697676, 24.134335548172757), (1, 17.967412790697676, 24.701025747508307), (1, 17.967412790697676, 25.134377076411962), (1, 17.967412790697676, 25.367720099667775), (1, 17.967412790697676, 26.801112956810634), (1, 17.967412790697676, 27.534476744186048), (1, 17.967412790697676, 27.63448089700997), (1, 17.967412790697676, 27.73448504983389), (1, 17.967412790697676, 27.86782392026578), (1, 17.967412790697676, 28.667857142857144), (1, 17.967412790697676, 29.667898671096346), (1, 17.967412790697676, 29.867906976744187), (1, 17.967412790697676, 30.334593023255817), (1, 24.93436877076412, 27.73448504983389), (1, 24.93436877076412, 27.86782392026578), (1, 24.93436877076412, 29.667898671096346), (1, 24.93436877076412, 29.867906976744187), (1, 24.93436877076412, 31.334634551495018), (1, 24.93436877076412, 31.66798172757475), (1, 24.93436877076412, 32.501349667774086), (1, 24.93436877076412, 35.334800664451826), (1, 24.93436877076412, 35.96816029900332), (1, 24.93436877076412, 36.168168604651164), (1, 24.93436877076412, 36.334842192691035), (1, 24.93436877076412, 36.93486710963455), (1, 24.93436877076412, 36.968201827242524), (1, 24.93436877076412, 40.135000000000005), (1, 24.93436877076412, 40.135000000000005), (2, 7.565094208922139, 10.831082017179273), (2, 7.565094208922139, 12.130811859240787), (2, 7.565094208922139, 12.76401357716819), (2, 7.565094208922139, 13.4305417013023), (2, 7.565094208922139, 13.730479357162649), (2, 7.565094208922139, 15.363473261291217), (2, 7.565094208922139, 15.396799667497922), (2, 7.565094208922139, 15.463452479911332), (2, 7.565094208922139, 16.529897478525907), (2, 7.565094208922139, 17.59634247714048), (2, 7.565094208922139, 17.59634247714048), (2, 7.565094208922139, 17.59634247714048), (2, 27.327653089498476, 32.72653089498476), (2, 27.327653089498476, 33.02646855084511), (2, 27.327653089498476, 34.792768079800496), (2, 27.327653089498476, 34.85942089221391), (2, 27.327653089498476, 36.49241479634248), (2, 27.327653089498476, 38.558651981158214), (2, 27.327653089498476, 38.991895261845386), (2, 27.327653089498476, 39.02522166805209), (2, 27.327653089498476, 39.79172901080632), (2, 27.327653089498476, 40.09166666666667), (4, 0.03324793388429752, 4.189239669421488), (4, 0.03324793388429752, 4.787702479338843), (4, 0.03324793388429752, 5.5191570247933885), (4, 0.03324793388429752, 5.618900826446281), (4, 0.03324793388429752, 6.948818181818182), (4, 0.03324793388429752, 7.24804958677686), (4, 0.03324793388429752, 7.281297520661157), (4, 0.03324793388429752, 8.112495867768596), (4, 0.03324793388429752, 8.611214876033058), (4, 0.03324793388429752, 9.242925619834711), (4, 0.03324793388429752, 9.808140495867768), (4, 0.03324793388429752, 10.539595041322315), (4, 0.03324793388429752, 11.769768595041322), (4, 2.2608595041322315, 5.5191570247933885), (4, 2.2608595041322315, 5.618900826446281), (4, 2.2608595041322315, 6.948818181818182), (4, 2.2608595041322315, 7.24804958677686), (4, 2.2608595041322315, 7.281297520661157), (4, 2.2608595041322315, 8.112495867768596), (4, 2.2608595041322315, 8.611214876033058), (4, 2.2608595041322315, 9.242925619834711), (4, 2.2608595041322315, 9.808140495867768), (4, 2.2608595041322315, 10.539595041322315), (4, 2.2608595041322315, 11.769768595041322)]
140

binary search + rare last, 5 videos:
query time:  12.25659728050232
[(0, 36.45453311166528, 40.123333333333335), (1, 0.0, 4.266843853820598), (1, 0.0, 5.233550664451827), (1, 0.0, 5.866910299003322), (1, 0.0, 6.766947674418605), (1, 0.0, 7.166964285714286), (1, 0.0, 8.600357142857144), (1, 0.0, 9.433725083056478), (1, 0.0, 9.967080564784053), (1, 0.0, 11.600481727574751), (1, 0.0, 12.600523255813954), (1, 0.0, 12.633857973421927), (1, 1.3667234219269104, 5.233550664451827), (1, 1.3667234219269104, 5.866910299003322), (1, 1.3667234219269104, 6.766947674418605), (1, 1.3667234219269104, 7.166964285714286), (1, 1.3667234219269104, 8.600357142857144), (1, 1.3667234219269104, 9.433725083056478), (1, 1.3667234219269104, 9.967080564784053), (1, 1.3667234219269104, 11.600481727574751), (1, 1.3667234219269104, 12.600523255813954), (1, 1.3667234219269104, 12.633857973421927), (1, 1.3667234219269104, 12.700527408637875), (1, 10.333762458471762, 12.700527408637875), (1, 10.333762458471762, 14.467267441860466), (1, 10.333762458471762, 15.167296511627908), (1, 10.333762458471762, 16.000664451827245), (1, 10.333762458471762, 16.500685215946845), (1, 10.333762458471762, 17.500726744186046), (1, 10.333762458471762, 18.067416943521597), (1, 10.333762458471762, 18.634107142857143), (1, 10.333762458471762, 19.96749584717608), (1, 10.333762458471762, 20.500851328903654), (1, 10.333762458471762, 20.934202657807308), (1, 10.333762458471762, 21.000872093023258), (1, 10.333762458471762, 21.800905315614617), (1, 10.333762458471762, 22.434264950166114), (1, 10.333762458471762, 22.767612126245847), (1, 10.333762458471762, 25.134377076411962), (1, 16.96737126245847, 19.96749584717608), (1, 16.96737126245847, 20.500851328903654), (1, 16.96737126245847, 20.934202657807308), (1, 16.96737126245847, 21.000872093023258), (1, 16.96737126245847, 21.800905315614617), (1, 16.96737126245847, 22.434264950166114), (1, 16.96737126245847, 22.767612126245847), (1, 16.96737126245847, 23.734318936877077), (1, 16.96737126245847, 23.767653654485052), (1, 16.96737126245847, 24.134335548172757), (1, 16.96737126245847, 24.701025747508307), (1, 16.96737126245847, 25.134377076411962), (1, 16.96737126245847, 25.367720099667775), (1, 16.96737126245847, 26.801112956810634), (1, 16.96737126245847, 27.534476744186048), (1, 16.96737126245847, 27.63448089700997), (1, 16.96737126245847, 27.73448504983389), (1, 16.96737126245847, 27.86782392026578), (1, 16.96737126245847, 28.667857142857144), (1, 16.96737126245847, 29.667898671096346), (1, 16.96737126245847, 30.334593023255817), (1, 17.967412790697676, 20.934202657807308), (1, 17.967412790697676, 21.800905315614617), (1, 17.967412790697676, 22.434264950166114), (1, 17.967412790697676, 22.767612126245847), (1, 17.967412790697676, 23.734318936877077), (1, 17.967412790697676, 23.767653654485052), (1, 17.967412790697676, 24.134335548172757), (1, 17.967412790697676, 24.701025747508307), (1, 17.967412790697676, 25.134377076411962), (1, 17.967412790697676, 25.367720099667775), (1, 17.967412790697676, 26.801112956810634), (1, 17.967412790697676, 27.534476744186048), (1, 17.967412790697676, 27.63448089700997), (1, 17.967412790697676, 27.73448504983389), (1, 17.967412790697676, 27.86782392026578), (1, 17.967412790697676, 28.667857142857144), (1, 17.967412790697676, 29.667898671096346), (1, 17.967412790697676, 29.867906976744187), (1, 17.967412790697676, 30.334593023255817), (1, 24.93436877076412, 27.73448504983389), (1, 24.93436877076412, 27.86782392026578), (1, 24.93436877076412, 29.667898671096346), (1, 24.93436877076412, 29.867906976744187), (1, 24.93436877076412, 31.334634551495018), (1, 24.93436877076412, 31.66798172757475), (1, 24.93436877076412, 32.501349667774086), (1, 24.93436877076412, 35.334800664451826), (1, 24.93436877076412, 35.96816029900332), (1, 24.93436877076412, 36.168168604651164), (1, 24.93436877076412, 36.334842192691035), (1, 24.93436877076412, 36.93486710963455), (1, 24.93436877076412, 36.968201827242524), (1, 24.93436877076412, 40.135000000000005), (1, 24.93436877076412, 40.135000000000005), (2, 7.565094208922139, 11.131019673039622), (2, 7.565094208922139, 12.130811859240787), (2, 7.565094208922139, 13.230583264062068), (2, 7.565094208922139, 13.4305417013023), (2, 7.565094208922139, 13.730479357162649), (2, 7.565094208922139, 15.363473261291217), (2, 7.565094208922139, 15.396799667497922), (2, 7.565094208922139, 15.69673732335827), (2, 7.565094208922139, 16.529897478525907), (2, 7.565094208922139, 17.896280133000833), (2, 7.565094208922139, 17.896280133000833), (2, 7.565094208922139, 17.929606539207537), (2, 7.565094208922139, 18.962725131615407), (2, 7.565094208922139, 20.062496536436687), (2, 7.565094208922139, 23.195178719867), (2, 27.327653089498476, 33.02646855084511), (2, 27.327653089498476, 34.392851205320035), (2, 27.327653089498476, 35.89253948462178), (2, 27.327653089498476, 38.4586727625381), (2, 27.327653089498476, 38.558651981158214), (2, 27.327653089498476, 38.991895261845386), (2, 27.327653089498476, 39.02522166805209), (2, 27.327653089498476, 39.79172901080632), (2, 27.327653089498476, 40.09166666666667), (4, 0.03324793388429752, 4.189239669421488), (4, 0.03324793388429752, 4.787702479338843), (4, 0.03324793388429752, 5.5191570247933885), (4, 0.03324793388429752, 5.618900826446281), (4, 0.03324793388429752, 6.948818181818182), (4, 0.03324793388429752, 7.24804958677686), (4, 0.03324793388429752, 7.281297520661157), (4, 0.03324793388429752, 8.112495867768596), (4, 0.03324793388429752, 8.611214876033058), (4, 0.03324793388429752, 9.242925619834711), (4, 0.03324793388429752, 9.808140495867768), (4, 0.03324793388429752, 10.539595041322315), (4, 0.03324793388429752, 11.769768595041322), (4, 2.2608595041322315, 5.5191570247933885), (4, 2.2608595041322315, 5.618900826446281), (4, 2.2608595041322315, 6.948818181818182), (4, 2.2608595041322315, 7.24804958677686), (4, 2.2608595041322315, 7.281297520661157), (4, 2.2608595041322315, 8.112495867768596), (4, 2.2608595041322315, 8.611214876033058), (4, 2.2608595041322315, 9.242925619834711), (4, 2.2608595041322315, 9.808140495867768), (4, 2.2608595041322315, 10.539595041322315), (4, 2.2608595041322315, 11.769768595041322), (4, 2.2608595041322315, 15.393793388429753)]
143
"""


"""
Query 2:
query time:  2.8341503143310547
[(2, 1.7329731227486838, 11.66424217234691), (2, 5.43220421169299, 11.66424217234691), (2, 7.065198115821557, 11.66424217234691)]
3

Query 2, binary search + rare first:
query time:  2.1459429264068604
[(2, 1.7329731227486838, 11.66424217234691), (2, 5.43220421169299, 11.66424217234691), (2, 7.065198115821557, 11.66424217234691)]
3

Query 2, binary search + rare last:
query time:  0.6089482307434082
[(2, 1.7329731227486838, 11.66424217234691), (2, 5.43220421169299, 11.66424217234691), (2, 7.065198115821557, 11.66424217234691)]
3
"""